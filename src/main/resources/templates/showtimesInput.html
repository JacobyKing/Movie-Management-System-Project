<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta name="Author" value="Jacoby King">
	<title>Insert Showtime</title>
	<script th:inline="javascript">
		let timesUsed = /*[[${timesUsed}]]*/ 'default';
		let currentMovies = /*[[${currentMovies}]]*/ 'default';
	</script>
	<script>
		function invalidField(inField){
			inField.style.backgroundColor = "#E55D40";
			event.preventDefault();
		}
		function validateFields(){
			let timeField = document.querySelector("input[name = 'time']");
			let theaterNumberField = document.querySelector("input[name = 'theaterNumber']");
			let errorMessage = "";
			timeField.style.backgroundColor = "#FFFFFF";
			theaterNumberField.style.backgroundColor = "#FFFFFF";
			//We can change this but as of now, the theater is open from 8 AM - 10 PM
			if(timeField.value == "" || (parseInt(timeField.value.substring(0, 2)) < 8 || parseInt(timeField.value.substring(0, 2)) > 22)){
				errorMessage += "The theater is not open during that time. ";
				invalidField(timeField);
			}
			for(let i = 0; i < timesUsed[parseInt(theaterNumberField.value) - 1].length; i++){
				console.log(timesUsed[i]);
				if(parseInt(timeField.value.substring(0, 2)) < parseInt(timesUsed[parseInt(theaterNumberField.value) - 1][i].substring(0,2)) + 2 && parseInt(timeField.value.substring(0, 2)) > parseInt(timesUsed[parseInt(theaterNumberField.value) - 1][i].substring(0,2)) - 2){
					errorMessage += "That theater is already in use at that time. ";
					invalidField(theaterNumberField);
					break;
				}
			}
			document.querySelector('span').innerHTML = errorMessage;
		}
	</script>
</head>
<body>
	<form th:object="${newShowtime}" th:action="@{/addShowtime}" method=POST>
		Movie:
		<!-- Add handling for this -->
		<select name="movie" th:field="*{movie}">
			<!-- Edit this -->
			<script>currentMovies.forEach(movie => document.write("<option value='" + movie.id + "'>" + movie.title + " || " + movie.genre + "</option>"))</script>
		</select><br/>
		Showtime: <input type="time" name="time" step="3600" th:field="*{time}" onchange="if(parseInt(value.substring(3,5)) != 0){value = value.substring(0,2) + ':00'}"><br />
		<!-- We can change this but as of now, only theaters 1 - 4 are valid theaters -->
		Theater Number: <input type="number" name="theaterNumber" size="10" th:field="*{theaterNumber}" min="1" max="4" onchange="if(value<1){value=1;} else if(value>4){value=4;}"><br/>
		<!-- We can change this but as of now, a specific showtimes can only be initialized with 1 - 60 available tickets -->
		Tickets Available: <input type="number" name="ticketsAvailable" size="5" th:field="*{ticketsAvailable}" min="1" max="60" onchange="if(value<1){value=1;} else if(value>60){value=60;}"><br />
		<input name="submit" type="submit" value="Submit" onclick="validateFields()"/>
		<script>
			document.querySelector("input[name = 'theaterNumber']").value = 1;
			document.querySelector("input[name = 'ticketsAvailable']").value = 1;
		</script>
	</form>
	<span></span><br>
	<button onclick="window.location.href='viewShowtimes'">View Showtimes</button>
	<button onclick="window.location.href='addMovie'">Add a Movie</button>
</body>
</html>